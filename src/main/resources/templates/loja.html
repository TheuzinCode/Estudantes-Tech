<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja</title>
    <link rel="stylesheet" th:href="@{/css/loja.css}">
</head>
<body>
    <header class="cabecalho">
        <img th:src="@{/img/logo.png}" width="45" height="45" alt="logo">
        <div>PETSHOP</div>
        <div class="right-icons">
            <a id="profile-link" href="/entrar" aria-label="Perfil ou Entrar">
                <img th:src="@{/img/perfil.png}" width="30" height="30" alt="perfil">
            </a>
            <img th:src="@{/img/carrinho.png}" width="30" height="30" alt="carrinho" id="open-cart">
            <button id="btn-logout" type="button" style="margin-left:8px; display:none;">Sair</button>
        </div>
    </header>

    <main>
        <section class="store-container">
            <div class="product-grid">
                <div class="product-card"
                     th:each="p : ${products}"
                     th:with="imgList=${p.imagesProducts},
                              principalList=${imgList.?[principal]},
                              imgId=${#lists.isEmpty(imgList) ? null : ( #lists.isEmpty(principalList) ? imgList[0].id : principalList[0].id)}">

                    <div class="product-image">
                        <img th:if="${imgId != null}" th:src="@{/images/{id}(id=${imgId})}" alt="Imagem do produto">
                        <img th:if="${imgId == null}" th:src="@{/img/logo.png}" alt="Sem imagem">
                    </div>

                    <div class="product-info">
                        <h4 th:text="${p.name}">Produto</h4>
                        <p class="price">R$ <span th:text="${p.price}">0,00</span></p>
                        <div class="product-actions">
                            <a class="btn-details" th:href="@{/loja/produto/{id}(id=${p.idProduct})}">Detalhes</a>
                            <button type="button" class="btn-buy"
                                    th:attr="data-id=${p.idProduct},
                                              data-name=${p.name},
                                              data-price=${p.price},
                                              data-imageid=${imgId}">Comprar</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Cart drawer -->
    <div class="cart-backdrop" id="cart-backdrop" aria-hidden="true"></div>
    <aside class="cart-sidebar" id="cart-sidebar" aria-hidden="true" aria-label="Carrinho de compras">
        <header class="cart-header">
            <h3>Carrinho</h3>
            <button type="button" class="cart-close" id="cart-close" aria-label="Fechar carrinho">&times;</button>
        </header>
        <div class="cart-body" id="cart-body">
            <p>Seu carrinho está vazio.</p>
        </div>
        <footer class="cart-footer">
            <div class="shipping-controls" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                <input type="text" id="cart-cep" placeholder="CEP" style="flex:1 1 0; min-width:120px;"/>
                <select id="cart-shipping" style="flex:1 1 0; min-width:180px;">
                    <option value="economico">Frete Econômico - $5</option>
                    <option value="expresso">Frete Expresso - $10</option>
                    <option value="premium">Frete Premium - $15</option>
                </select>
            </div>
            <div class="subtotal">Subtotal: R$ <span id="cart-subtotal">0,00</span></div>
        </footer>
    </aside>

    <footer></footer>

    <script th:src="@{/js/carrinho.js}"></script>
    <script th:src="@{/js/loja.js}"></script>
</body>
</html>